{
  "name": "SG FAQ RAG Multi Sheet",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        0,
        0
      ],
      "id": "fba5babb-f088-4583-9d09-519cdb2f92e4",
      "name": "When chat message received",
      "webhookId": "1e36aa33-fe60-4eac-a4a9-e9db0e60bbc5"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=You are a smart, factual e-commerce FAQ assistant that answers customer questions using three Google Sheets as your knowledge sources. \nEach sheet acts as a separate tool.\n\nTOOLS AND THEIR STRUCTURE\n--------------------------------------------------\n1) Policies_Terms\n   Columns: policy_area, question_canonical, policy_answer, window_or_limits\n   → Use this sheet for company policies like shipping, returns, exchanges, cancellations, COD, warranty, etc.\n\n2) Product_Knowledge\n   Columns: product_name, category, materials, care, warranty_note\n   → Use this sheet for product-related questions like fabric, material, wash care, category, and warranty.\n\n3) Operations_Contact\n   Columns: topic, contact_email, whatsapp_number, phone_hours\n   → Use this sheet for contact details, escalation, or support information.\n\n--------------------------------------------------\nTOOL ACCESS FUNCTIONS\n- find_policy(query: string)\n  → returns matching rows from Policies_Terms\n- find_product(query: string)\n  → returns matching rows from Product_Knowledge\n- find_ops(query: string)\n  → returns one or more rows from Operations_Contact\n\n--------------------------------------------------\nREASONING AND BEHAVIOR\n1. Classify the incoming user message:\n   - If about delivery, return, refund, cancellation, payment, or warranty → call find_policy.\n   - If about a product’s material, fabric, category, or care → call find_product.\n   - If about customer support, escalation, or contact → call find_ops.\n\n2. When calling a tool:\n   - Use short keyword queries (3–6 words) representing the user’s intent.\n   - Retrieve all possible matches, then pick the most relevant row by comparing the user’s question to question_canonical or product_name fields.\n\n3. Response construction:\n   - Start with a clear, direct answer (1–2 sentences) based on the best matched row.\n   - Then provide 2–4 concise bullet points with useful details:\n       • key time windows (from window_or_limits if applicable)\n       • material/care/warranty details if product-related\n       • contact info (from Operations_Contact) if user asks for support\n   - If no confident match is found, respond with:\n       “I couldn’t find that information in our FAQs. Would you like me to connect you to our support team?”\n     Then include the default contact details from the Operations_Contact sheet (topic=\"General\" if present).\n\n4. Ranking and selection:\n   - Prioritize the row whose question_canonical or product_name is most semantically similar to the query.\n   - If multiple rows are equally relevant, choose one and mention “Related FAQs” listing the other question_canonical or product_name values.\n\n5. Safety and integrity:\n   - Never generate or assume new data beyond the sheet content.\n   - Always prefer data freshness and clarity over verbosity.\n   - Use Indian context where timelines or prices may differ.\n\n--------------------------------------------------\nRESPONSE FORMAT EXAMPLE\nAnswer:\n<short final answer from policy_answer or equivalent field>\n\nDetails:\n• <window_or_limits or care/warranty_note>\n• <additional bullet points if applicable>\n\nIf relevant:\n• Contact: <contact_email> / <whatsapp_number> (<phone_hours>)\n• Related FAQs: <comma-separated question_canonical values>\n\n--------------------------------------------------\nSTYLE\n- Tone: Friendly, concise, trustworthy.\n- Format: Use short paragraphs or bullets. No emojis or unnecessary text.\n- Objective: Solve the customer’s query quickly and accurately, based solely on the data provided.\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        208,
        0
      ],
      "id": "77c55f6f-08b7-4605-b064-7b14cb49e91f",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        80,
        208
      ],
      "id": "f1f333e7-93c4-4aad-9a01-9f711bd5b7f9",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "p5hxeYZcLwpy0hRn",
          "name": "SG_GoogleGemini_New"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        208,
        208
      ],
      "id": "a264235d-b638-4ccf-b98c-98b5217bfc88",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1f1YIQvey4LyULQJcAO7ow2MDl_jmeiSqa3unErsDzdM",
          "mode": "list",
          "cachedResultName": "20251109 - E-commerce FAQs - V2",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1f1YIQvey4LyULQJcAO7ow2MDl_jmeiSqa3unErsDzdM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Policies_Terms",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1f1YIQvey4LyULQJcAO7ow2MDl_jmeiSqa3unErsDzdM/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        384,
        224
      ],
      "id": "41ffda82-99c9-417a-a051-71424efd31c1",
      "name": "Policies_Terms",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "swHN4rGGgv0MH5qi",
          "name": "SG Techie Google Sheets account 5"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1f1YIQvey4LyULQJcAO7ow2MDl_jmeiSqa3unErsDzdM",
          "mode": "list",
          "cachedResultName": "20251109 - E-commerce FAQs - V2",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1f1YIQvey4LyULQJcAO7ow2MDl_jmeiSqa3unErsDzdM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 107927771,
          "mode": "list",
          "cachedResultName": "Product_Knowledge",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1f1YIQvey4LyULQJcAO7ow2MDl_jmeiSqa3unErsDzdM/edit#gid=107927771"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        528,
        224
      ],
      "id": "1aa3b8de-84d5-4cda-a67f-a354cfaa51bf",
      "name": "Product_Knowledge",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "swHN4rGGgv0MH5qi",
          "name": "SG Techie Google Sheets account 5"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1f1YIQvey4LyULQJcAO7ow2MDl_jmeiSqa3unErsDzdM",
          "mode": "list",
          "cachedResultName": "20251109 - E-commerce FAQs - V2",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1f1YIQvey4LyULQJcAO7ow2MDl_jmeiSqa3unErsDzdM/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1255456453,
          "mode": "list",
          "cachedResultName": "Operations_Contact",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1f1YIQvey4LyULQJcAO7ow2MDl_jmeiSqa3unErsDzdM/edit#gid=1255456453"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        704,
        224
      ],
      "id": "d45f981f-d023-4a04-8f88-db27d1722399",
      "name": "Operations_Contact",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "swHN4rGGgv0MH5qi",
          "name": "SG Techie Google Sheets account 5"
        }
      }
    },
    {
      "parameters": {
        "content": "## Questions to ask \n1) What is the return policy?\n2) Do you have earbuds?\n3) How to get in touch?"
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -320,
        16
      ],
      "typeVersion": 1,
      "id": "7f5859d4-fd23-4487-88de-2fd00db24766",
      "name": "Sticky Note"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Policies_Terms": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Product_Knowledge": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Operations_Contact": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "cb2e25cd-b948-41de-b59d-d26289ef0364",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "e99e0d1157c9445a053edb1d8bcb3c19869f806f2b50808813faa4f314de9dd4"
  },
  "id": "Wgj5pSsDLppbbKzR",
  "tags": []
}
